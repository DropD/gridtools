#
# path to gridtools
#
GRIDTOOLS_HOME ?= ${HOME}/src/gridtools

#
# compiler flags
# 
CC := c++
CCFLAGS := -fPIC -std=c++11 -DBACKEND_BLOCK -DFLOAT_PRECISION=8 -DCXX11_ENABLED -fopenmp
LIBRARIES := -lc
INCLUDES  := -I. -I$(GRIDTOOLS_HOME)/include -I$(GRIDTOOLS_HOME)/include/communication/high-level -isystem $(GRIDTOOLS_HOME)/fussion/include
GENCODE := -shared -Wl,-soname,libcopystencil.so

#ifeq ($(CXX),c++)
#CCFLAGS+=-DGPU_LOCALITY
#INCLUDES+= -I$(HWLOC_PATH)/include
#LIBRARIES+= -L$(HWLOC_PATH)/lib -lhwloc -lcuda
#endif

# Target rules
all: build

build: copystencil

copystencil: /tmp/__gridtools_rbd7hngl/CopyStencil_ktygrh_9.cpp.o
	$(CC) $(GENCODE) -o /tmp/__gridtools_rbd7hngl/libcopystencil.so $+ $(LIBRARIES)

/tmp/__gridtools_rbd7hngl/CopyStencil_ktygrh_9.cpp.o: /tmp/__gridtools_rbd7hngl/CopyStencil_ktygrh_9.cpp
	$(CC) $(CCFLAGS) $(INCLUDES) -o $@ -c $<

clean:
	rm -f /tmp/__gridtools_rbd7hngl/libcopystencil.so
	rm -f /tmp/__gridtools_rbd7hngl/CopyStencil_ktygrh_9.cpp.o